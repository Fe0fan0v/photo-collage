# Инструкция по настройке Google Sheets и Google Drive

Эта инструкция поможет настроить автоматическое сохранение коллажей в Google Drive и данных в Google Sheets. Все настройки выполняются через веб-интерфейс, без программирования.

---

## Часть 1: Создание проекта в Google Cloud Console

### Шаг 1: Создайте проект

1. Откройте [Google Cloud Console](https://console.cloud.google.com/)
2. Войдите в свой Google аккаунт (рабочий или личный)
3. Нажмите на выпадающий список проектов в верхней части страницы
4. Нажмите **"Новый проект"** (New Project)
5. Введите название проекта: `Seletti Collage App`
6. Нажмите **"Создать"** (Create)
7. Дождитесь создания проекта (займет 10-20 секунд)
8. Убедитесь, что новый проект выбран в верхнем меню

### Шаг 2: Включите необходимые API

1. В левом меню выберите **"API и сервисы"** → **"Библиотека"**
2. В поисковой строке найдите **"Google Sheets API"**
3. Нажмите на результат поиска
4. Нажмите кнопку **"Включить"** (Enable)
5. Дождитесь активации API

6. Вернитесь в библиотеку (нажмите кнопку "назад" или выберите "Библиотека" в меню)
7. В поисковой строке найдите **"Google Drive API"**
8. Нажмите на результат поиска
9. Нажмите кнопку **"Включить"** (Enable)
10. Дождитесь активации API

---

## Часть 2: Создание Service Account (учетной записи сервиса)

Service Account - это специальный аккаунт для приложений, который будет загружать коллажи и записывать данные от имени вашего приложения.

### Шаг 1: Создайте Service Account

1. В левом меню выберите **"IAM и администрирование"** → **"Сервисные аккаунты"**
2. Нажмите **"+ Создать сервисный аккаунт"** в верхней части страницы
3. Заполните форму:
   - **Название сервисного аккаунта**: `collage-service`
   - **ID сервисного аккаунта**: автоматически заполнится как `collage-service@...`
   - **Описание**: `Service account for Seletti Collage App`
4. Нажмите **"Создать и продолжить"**

5. В разделе "Предоставить этому сервисному аккаунту доступ к проекту":
   - Оставьте поле "Роль" пустым (роли не нужны для этого проекта)
   - Нажмите **"Продолжить"**

6. В разделе "Предоставить пользователям доступ к этому сервисному аккаунту":
   - Оставьте поля пустыми
   - Нажмите **"Готово"**

### Шаг 2: Создайте ключ для Service Account

1. В списке сервисных аккаунтов найдите созданный `collage-service`
2. Нажмите на три точки (⋮) справа от аккаунта
3. Выберите **"Управление ключами"** (Manage keys)
4. Нажмите **"Добавить ключ"** → **"Создать новый ключ"**
5. Выберите тип ключа: **JSON**
6. Нажмите **"Создать"**
7. Файл с ключом (например, `seletti-collage-app-abc123.json`) автоматически скачается на ваш компьютер

**ВАЖНО:**
- Этот файл содержит секретные данные - храните его в безопасности!
- Не публикуйте этот файл в интернете
- Не отправляйте через незащищенные каналы

### Шаг 3: Скопируйте email Service Account

1. Откройте скачанный JSON файл в текстовом редакторе
2. Найдите строку `"client_email"`, она будет выглядеть примерно так:
   ```json
   "client_email": "collage-service@seletti-collage-app-abc123.iam.gserviceaccount.com"
   ```
3. **Скопируйте этот email** - он понадобится в следующих шагах

---

## Часть 3: Настройка Google Sheets

### Шаг 1: Создайте таблицу

1. Откройте [Google Sheets](https://sheets.google.com)
2. Нажмите **"+ Создать"** → **"Google Таблицы"**
3. Назовите таблицу: `Seletti Collages Database`

### Шаг 2: Настройте заголовки

В первой строке создайте 5 столбцов:

| A | B | C | D | E |
|---|---|---|---|---|
| ID | Дата и время | Email | Тип клиента | Ссылка на коллаж |

### Шаг 3: Предоставьте доступ Service Account

1. Нажмите кнопку **"Настройки доступа"** (Share) в правом верхнем углу
2. Вставьте **email Service Account** (который вы скопировали ранее)
3. Выберите роль: **"Редактор"** (Editor)
4. **ВАЖНО:** Снимите галочку **"Уведомить пользователей"**
5. Нажмите **"Поделиться"** или **"Отправить"**

### Шаг 4: Скопируйте ID таблицы

1. Посмотрите на URL таблицы в адресной строке браузера:
   ```
   https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
   ```
2. ID таблицы - это длинная строка между `/d/` и `/edit`
3. В примере выше: `1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`
4. **Сохраните этот ID** - он понадобится для настройки

---

## Часть 4: Настройка Google Drive

### Шаг 1: Создайте папку для коллажей

1. Откройте [Google Drive](https://drive.google.com)
2. Нажмите **"+ Создать"** → **"Новая папка"**
3. Назовите папку: `Seletti Collages`
4. Нажмите **"Создать"**

### Шаг 2: Предоставьте доступ Service Account

1. Найдите созданную папку `Seletti Collages`
2. Нажмите правой кнопкой мыши на папку
3. Выберите **"Настройки доступа"** (Share)
4. Вставьте **email Service Account** (тот же, что использовали для Sheets)
5. Выберите роль: **"Редактор"** (Editor)
6. **ВАЖНО:** Снимите галочку **"Уведомить пользователей"**
7. Нажмите **"Поделиться"** или **"Отправить"**

### Шаг 3: Настройте публичный доступ к папке

Чтобы коллажи были доступны по прямым ссылкам:

1. Нажмите правой кнопкой мыши на папку `Seletti Collages`
2. Выберите **"Настройки доступа"**
3. В разделе "Общий доступ" нажмите **"Изменить"**
4. Выберите **"Все, у кого есть ссылка"**
5. Убедитесь, что выбрана роль **"Читатель"** (Viewer)
6. Нажмите **"Готово"**
7. Нажмите **"Копировать ссылку"** и сохраните её

### Шаг 4: Получите ID папки

1. Откройте папку `Seletti Collages` в Google Drive
2. Посмотрите на URL в адресной строке:
   ```
   https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j
   ```
3. ID папки - это строка после `/folders/`
4. В примере выше: `1a2b3c4d5e6f7g8h9i0j`
5. **Сохраните этот ID** - он понадобится для настройки

---

## Часть 5: Передайте данные разработчику

После выполнения всех шагов передайте разработчику следующие данные:

### 1. Файл с ключом Service Account
- Файл `seletti-collage-app-abc123.json` (который скачался на шаге 2.2)
- Отправьте его через защищенный канал (например, зашифрованный архив)

### 2. ID Google Sheets
```
GOOGLE_SHEETS_ID=1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms
```

### 3. ID папки Google Drive
```
GOOGLE_DRIVE_FOLDER_ID=1a2b3c4d5e6f7g8h9i0j
```

---

## Проверка настройки

### Проверка Google Sheets:

1. Откройте вашу таблицу `Seletti Collages Database`
2. Убедитесь, что в списке "Настройки доступа" есть email Service Account
3. Убедитесь, что у Service Account роль "Редактор"

### Проверка Google Drive:

1. Откройте папку `Seletti Collages` в Google Drive
2. Убедитесь, что в списке "Настройки доступа" есть email Service Account
3. Убедитесь, что у Service Account роль "Редактор"
4. Убедитесь, что общий доступ установлен как "Все, у кого есть ссылка" с ролью "Читатель"

---

## Безопасность

**Важные правила:**

1. **Не публикуйте JSON файл с ключом**
   - Не загружайте его в публичные репозитории (GitHub, GitLab)
   - Не отправляйте через незащищенную почту
   - Не публикуйте в чатах или форумах

2. **Ограничьте доступ к Google Cloud проекту**
   - Дайте доступ только необходимым сотрудникам
   - Используйте двухфакторную аутентификацию

3. **Регулярно проверяйте активность**
   - Просматривайте историю изменений в Google Sheets
   - Проверяйте содержимое папки Google Drive

4. **Если ключ скомпрометирован**
   - Немедленно удалите старый ключ в Google Cloud Console
   - Создайте новый ключ
   - Обновите конфигурацию на сервере

---

## Устранение неполадок

### Проблема: "Permission denied" или "Access denied"

**Решение:**
1. Проверьте, что Service Account добавлен в настройки доступа таблицы/папки
2. Убедитесь, что у Service Account роль "Редактор"
3. Попробуйте удалить Service Account из доступа и добавить заново

### Проблема: "API not enabled"

**Решение:**
1. Откройте Google Cloud Console
2. Перейдите в "API и сервисы" → "Библиотека"
3. Найдите нужный API (Sheets или Drive)
4. Убедитесь, что он включен (статус "API enabled")

### Проблема: Коллажи не загружаются в Drive

**Решение:**
1. Проверьте, что ID папки правильный
2. Убедитесь, что Service Account имеет доступ к папке
3. Проверьте лимиты хранилища Google Drive (15 GB для бесплатного аккаунта)

### Проблема: Данные не записываются в Sheets

**Решение:**
1. Проверьте, что ID таблицы правильный
2. Откройте таблицу и убедитесь, что первая строка содержит заголовки
3. Проверьте, что Service Account не был удален из доступа

---

## Лимиты и ограничения

### Google Sheets API:
- **Бесплатно**: 300 запросов в минуту на проект
- **Лимит строк**: до 5 000 000 ячеек в таблице

### Google Drive API:
- **Бесплатно**: 1000 запросов в 100 секунд на пользователя
- **Хранилище**: 15 GB для бесплатного аккаунта
- **Размер файла**: до 5 TB на файл

Для большинства использований этих лимитов более чем достаточно.

---

## Дополнительные возможности

После настройки вы сможете:

1. **Просматривать статистику**
   - Открыть Google Sheets и увидеть все коллажи
   - Фильтровать по дате, email, типу клиента
   - Создавать графики и отчеты

2. **Экспортировать данные**
   - Скачать таблицу как Excel (File → Download → .xlsx)
   - Скачать как CSV для анализа в других программах

3. **Делиться с коллегами**
   - Добавить коллег в настройки доступа таблицы
   - Они смогут просматривать или редактировать данные

4. **Архивировать старые коллажи**
   - Создать подпапки в Google Drive по месяцам
   - Переместить старые файлы в архив

---

## Автоматическое резервное копирование (опционально)

Для дополнительной безопасности данных:

1. **Google Takeout**
   - Периодически экспортируйте данные через https://takeout.google.com
   - Выберите "Drive" и "Sheets"
   - Получите архив с копией всех данных

2. **Автоматическая синхронизация**
   - Установите Google Drive для компьютера
   - Настройте синхронизацию папки `Seletti Collages`
   - Локальная копия будет всегда актуальна

---

## Стоимость

**Все используемые сервисы бесплатны** при умеренном использовании:

- Google Cloud Console: бесплатный проект
- Google Sheets API: бесплатно до 300 запросов/минуту
- Google Drive API: бесплатно до 1000 запросов/100 секунд
- Google Drive хранилище: 15 GB бесплатно

Если лимитов не хватит, можно перейти на платный план Google Workspace, но для большинства случаев бесплатного более чем достаточно.

---

## Контакты для помощи

Если возникли проблемы с настройкой:

1. Сделайте скриншоты ошибок
2. Запишите точный текст сообщения об ошибке
3. Укажите на каком шаге возникла проблема
4. Свяжитесь с разработчиком с этой информацией
